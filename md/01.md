# LOVE4DETAILING REBUILD: PHASE 1 IMPLEMENTATION GUIDE
## Foundation & Database Setup (Days 1-2)

---

## Overview

This phase establishes the architectural foundation that will support the entire application. Every decision made here directly impacts development speed, code quality, and deployment success. Follow each step methodically - rushing this phase creates problems that compound throughout the project.

---

## PRE-PHASE CHECKLIST

Before starting any development work, ensure you have:

- [ ] Fresh Supabase project created and accessible
- [ ] Supabase project URL and anon key available
- [ ] Vercel account ready for deployment
- [ ] Domain name ready (if using custom domain)
- [ ] Existing component library files ready to import
- [ ] Development environment with Node.js 18+ installed

---

## STEP 1: PROJECT INITIALIZATION (30 minutes)

### 1.1 Create Next.js 14 Project with Strict Configuration

```bash
npx create-next-app@latest love4detailing-rebuild --typescript --tailwind --eslint --app --src-dir --import-alias "@/*"
```

**Critical Configuration Requirements:**

Navigate to the project directory and immediately configure TypeScript for strict mode:

**File: `tsconfig.json`**
Replace the entire contents with this exact configuration:

```json
{
  "compilerOptions": {
    "lib": ["dom", "dom.iterable", "es6"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },
    "noUncheckedIndexedAccess": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

**Why this matters:** These strict TypeScript settings will catch type errors that would otherwise cause Vercel deployment failures. Every component and function must be properly typed from the start.

### 1.2 Install Required Dependencies

Execute this exact command to install all necessary packages:

```bash
npm install @supabase/supabase-js @supabase/ssr zustand class-variance-authority clsx tailwind-merge zod lucide-react @radix-ui/react-dialog @radix-ui/react-dropdown-menu @radix-ui/react-select @radix-ui/react-toast date-fns react-hook-form @hookform/resolvers
```

**Then install development dependencies:**

```bash
npm install -D @types/node @types/react @types/react-dom eslint-config-next
```

**Dependency Rationale:**
- `@supabase/ssr`: Handles server-side authentication properly
- `zustand`: State management following CLAUDE.md principles
- `class-variance-authority`: Component styling system
- `zod`: Runtime validation for all API endpoints
- `@radix-ui/*`: Accessible UI primitives
- `react-hook-form`: Form handling with proper validation

### 1.3 Environment Configuration

**File: `.env.local`**
Create this file in the project root with the following structure:

```bash
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Application Environment
NEXT_PUBLIC_APP_ENV=development
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Business Configuration
NEXT_PUBLIC_COMPANY_NAME=Love4Detailing
NEXT_PUBLIC_COMPANY_PHONE=+447123456789
NEXT_PUBLIC_COMPANY_EMAIL=info@love4detailing.co.uk
NEXT_PUBLIC_SERVICE_RADIUS_MILES=17.5

# Email Configuration (will be configured in Phase 3)
RESEND_API_KEY=your_resend_key_here
NEXT_PUBLIC_FROM_EMAIL=noreply@love4detailing.co.uk
```

**File: `.env.example`**
Create this file for documentation:

```bash
# Copy this file to .env.local and fill in your actual values
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=
NEXT_PUBLIC_APP_ENV=development
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_COMPANY_NAME=Love4Detailing
NEXT_PUBLIC_COMPANY_PHONE=
NEXT_PUBLIC_COMPANY_EMAIL=
NEXT_PUBLIC_SERVICE_RADIUS_MILES=17.5
RESEND_API_KEY=
NEXT_PUBLIC_FROM_EMAIL=
```

**Critical Note:** Replace the placeholder values with your actual Supabase credentials. The service role key should be kept secure and never committed to version control.

---

## STEP 2: SUPABASE DATABASE SCHEMA DESIGN (45 minutes)

### 2.1 Core Database Architecture

Navigate to your Supabase dashboard and access the SQL Editor. Execute the following schema creation scripts in the exact order provided.

**Critical Principle:** This database schema follows the "Single Source of Truth" principle from CLAUDE.md. Every piece of data has one authoritative location, and relationships are properly defined with foreign keys.

### 2.2 User Profiles and Authentication

```sql
-- Enable required extensions
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create user profiles table
CREATE TABLE user_profiles (
    id UUID REFERENCES auth.users(id) PRIMARY KEY,
    email VARCHAR(255) NOT NULL,
    first_name VARCHAR(100),
    last_name VARCHAR(100),
    phone VARCHAR(20),
    role VARCHAR(20) DEFAULT 'customer' CHECK (role IN ('customer', 'admin', 'super_admin')),
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create trigger for updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_user_profiles_updated_at 
    BEFORE UPDATE ON user_profiles 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();
```

### 2.3 Service Management System

```sql
-- Service categories
CREATE TABLE service_categories (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    display_order INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Vehicle size categories for pricing
CREATE TABLE vehicle_sizes (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    name VARCHAR(50) NOT NULL UNIQUE, -- 'Small', 'Medium', 'Large', 'XL'
    description TEXT,
    price_multiplier DECIMAL(3,2) DEFAULT 1.00, -- 1.00, 1.20, 1.50, 1.80
    examples TEXT[], -- Array of example vehicles
    display_order INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Core services
CREATE TABLE services (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    category_id UUID REFERENCES service_categories(id) ON DELETE CASCADE,
    name VARCHAR(200) NOT NULL,
    slug VARCHAR(200) NOT NULL UNIQUE,
    short_description TEXT,
    full_description TEXT,
    base_price DECIMAL(10,2) NOT NULL, -- Base price for small vehicles
    duration_minutes INTEGER NOT NULL,
    is_mobile_only BOOLEAN DEFAULT true,
    requires_water_source BOOLEAN DEFAULT false,
    requires_power_source BOOLEAN DEFAULT false,
    max_vehicles_per_slot INTEGER DEFAULT 1,
    is_active BOOLEAN DEFAULT true,
    display_order INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE TRIGGER update_services_updated_at 
    BEFORE UPDATE ON services 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();
```

### 2.4 Customer and Location Management

```sql
-- Customer addresses
CREATE TABLE customer_addresses (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    user_id UUID REFERENCES user_profiles(id) ON DELETE CASCADE,
    address_line_1 VARCHAR(255) NOT NULL,
    address_line_2 VARCHAR(255),
    city VARCHAR(100) NOT NULL,
    postal_code VARCHAR(20) NOT NULL,
    county VARCHAR(100),
    country VARCHAR(2) DEFAULT 'GB',
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    distance_from_base DECIMAL(5,2), -- Calculated distance in miles
    is_primary BOOLEAN DEFAULT false,
    is_verified BOOLEAN DEFAULT false,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE TRIGGER update_customer_addresses_updated_at 
    BEFORE UPDATE ON customer_addresses 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();

-- Customer vehicles
CREATE TABLE customer_vehicles (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    user_id UUID REFERENCES user_profiles(id) ON DELETE CASCADE,
    vehicle_size_id UUID REFERENCES vehicle_sizes(id),
    make VARCHAR(50),
    model VARCHAR(50),
    year INTEGER,
    color VARCHAR(30),
    license_plate VARCHAR(20),
    notes TEXT,
    is_primary BOOLEAN DEFAULT false,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE TRIGGER update_customer_vehicles_updated_at 
    BEFORE UPDATE ON customer_vehicles 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();
```

### 2.5 Booking and Scheduling System

```sql
-- Booking status enum type
CREATE TYPE booking_status AS ENUM (
    'pending',
    'confirmed', 
    'in_progress',
    'completed',
    'cancelled',
    'no_show'
);

-- Time slots for booking availability
CREATE TABLE time_slots (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    slot_date DATE NOT NULL,
    start_time TIME NOT NULL,
    end_time TIME NOT NULL,
    max_bookings INTEGER DEFAULT 1,
    is_available BOOLEAN DEFAULT true,
    created_by UUID REFERENCES user_profiles(id),
    notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(slot_date, start_time)
);

-- Main bookings table
CREATE TABLE bookings (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    booking_reference VARCHAR(20) NOT NULL UNIQUE,
    customer_id UUID REFERENCES user_profiles(id) ON DELETE CASCADE,
    service_id UUID REFERENCES services(id),
    vehicle_id UUID REFERENCES customer_vehicles(id),
    address_id UUID REFERENCES customer_addresses(id),
    time_slot_id UUID REFERENCES time_slots(id),
    
    -- Pricing information (captured at booking time)
    base_price DECIMAL(10,2) NOT NULL,
    vehicle_size_multiplier DECIMAL(3,2) DEFAULT 1.00,
    distance_surcharge DECIMAL(10,2) DEFAULT 0.00,
    total_price DECIMAL(10,2) NOT NULL,
    
    -- Booking details
    status booking_status DEFAULT 'pending',
    special_instructions TEXT,
    internal_notes TEXT,
    
    -- Scheduling
    scheduled_date DATE NOT NULL,
    scheduled_start_time TIME NOT NULL,
    scheduled_end_time TIME NOT NULL,
    actual_start_time TIMESTAMP WITH TIME ZONE,
    actual_end_time TIMESTAMP WITH TIME ZONE,
    
    -- Payment tracking
    payment_method VARCHAR(50), -- 'cash', 'card', 'bank_transfer'
    payment_status VARCHAR(20) DEFAULT 'pending', -- 'pending', 'paid', 'refunded'
    payment_reference VARCHAR(100),
    
    -- Timestamps
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    cancelled_at TIMESTAMP WITH TIME ZONE,
    cancelled_by UUID REFERENCES user_profiles(id),
    cancellation_reason TEXT
);

CREATE TRIGGER update_bookings_updated_at 
    BEFORE UPDATE ON bookings 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();
```

### 2.6 Content Management Tables

```sql
-- Testimonials management
CREATE TABLE testimonials (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    customer_name VARCHAR(100) NOT NULL,
    customer_location VARCHAR(100),
    service_name VARCHAR(100),
    rating INTEGER CHECK (rating >= 1 AND rating <= 5),
    review_text TEXT NOT NULL,
    is_featured BOOLEAN DEFAULT false,
    is_verified BOOLEAN DEFAULT false,
    display_order INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- FAQ management
CREATE TABLE faq_items (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    question TEXT NOT NULL,
    answer TEXT NOT NULL,
    category VARCHAR(50) DEFAULT 'general',
    display_order INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Site configuration
CREATE TABLE site_settings (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    setting_key VARCHAR(100) NOT NULL UNIQUE,
    setting_value JSONB NOT NULL,
    description TEXT,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE TRIGGER update_testimonials_updated_at 
    BEFORE UPDATE ON testimonials 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_faq_items_updated_at 
    BEFORE UPDATE ON faq_items 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_site_settings_updated_at 
    BEFORE UPDATE ON site_settings 
    FOR EACH ROW 
    EXECUTE FUNCTION update_updated_at_column();
```

### 2.7 Indexes for Performance

```sql
-- Performance indexes
CREATE INDEX idx_bookings_customer_id ON bookings(customer_id);
CREATE INDEX idx_bookings_scheduled_date ON bookings(scheduled_date);
CREATE INDEX idx_bookings_status ON bookings(status);
CREATE INDEX idx_bookings_reference ON bookings(booking_reference);
CREATE INDEX idx_customer_addresses_user_id ON customer_addresses(user_id);
CREATE INDEX idx_customer_vehicles_user_id ON customer_vehicles(user_id);
CREATE INDEX idx_time_slots_date ON time_slots(slot_date);
CREATE INDEX idx_services_category ON services(category_id);
CREATE INDEX idx_services_active ON services(is_active);
```

---

## STEP 3: ROW LEVEL SECURITY POLICIES (30 minutes)

### 3.1 Enable RLS on All Tables

```sql
-- Enable Row Level Security
ALTER TABLE user_profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE customer_addresses ENABLE ROW LEVEL SECURITY;
ALTER TABLE customer_vehicles ENABLE ROW LEVEL SECURITY;
ALTER TABLE bookings ENABLE ROW LEVEL SECURITY;
ALTER TABLE time_slots ENABLE ROW LEVEL SECURITY;
ALTER TABLE services ENABLE ROW LEVEL SECURITY;
ALTER TABLE service_categories ENABLE ROW LEVEL SECURITY;
ALTER TABLE vehicle_sizes ENABLE ROW LEVEL SECURITY;
ALTER TABLE testimonials ENABLE ROW LEVEL SECURITY;
ALTER TABLE faq_items ENABLE ROW LEVEL SECURITY;
ALTER TABLE site_settings ENABLE ROW LEVEL SECURITY;
```

### 3.2 User Profile Policies

```sql
-- User profiles: Users can read their own profile, admins can read all
CREATE POLICY "Users can view own profile" ON user_profiles
    FOR SELECT USING (auth.uid() = id);

CREATE POLICY "Users can update own profile" ON user_profiles
    FOR UPDATE USING (auth.uid() = id);

CREATE POLICY "Admins can view all profiles" ON user_profiles
    FOR SELECT USING (
        EXISTS (
            SELECT 1 FROM user_profiles 
            WHERE id = auth.uid() 
            AND role IN ('admin', 'super_admin')
        )
    );

CREATE POLICY "Admins can update all profiles" ON user_profiles
    FOR UPDATE USING (
        EXISTS (
            SELECT 1 FROM user_profiles 
            WHERE id = auth.uid() 
            AND role IN ('admin', 'super_admin')
        )
    );
```

### 3.3 Customer Data Policies

```sql
-- Customer addresses: Users see their own, admins see all
CREATE POLICY "Users can manage own addresses" ON customer_addresses
    FOR ALL USING (auth.uid() = user_id);

CREATE POLICY "Admins can view all addresses" ON customer_addresses
    FOR SELECT USING (
        EXISTS (
            SELECT 1 FROM user_profiles 
            WHERE id = auth.uid() 
            AND role IN ('admin', 'super_admin')
        )
    );

-- Customer vehicles: Users see their own, admins see all
CREATE POLICY "Users can manage own vehicles" ON customer_vehicles
    FOR ALL USING (auth.uid() = user_id);

CREATE POLICY "Admins can view all vehicles" ON customer_vehicles
    FOR SELECT USING (
        EXISTS (
            SELECT 1 FROM user_profiles 
            WHERE id = auth.uid() 
            AND role IN ('admin', 'super_admin')
        )
    );
```

### 3.4 Booking Policies

```sql
-- Bookings: Complex policies for customer vs admin access
CREATE POLICY "Customers can view own bookings" ON bookings
    FOR SELECT USING (auth.uid() = customer_id);

CREATE POLICY "Customers can create bookings" ON bookings
    FOR INSERT WITH CHECK (auth.uid() = customer_id);

CREATE POLICY "Customers can update own pending bookings" ON bookings
    FOR UPDATE USING (
        auth.uid() = customer_id 
        AND status IN ('pending', 'confirmed')
        AND scheduled_date > CURRENT_DATE
    );

CREATE POLICY "Admins can manage all bookings" ON bookings
    FOR ALL USING (
        EXISTS (
            SELECT 1 FROM user_profiles 
            WHERE id = auth.uid() 
            AND role IN ('admin', 'super_admin')
        )
    );
```

### 3.5 Public Data Policies

```sql
-- Services: Public read, admin write
CREATE POLICY "Anyone can view active services" ON services
    FOR SELECT USING (is_active = true);

CREATE POLICY "Admins can manage services" ON services
    FOR ALL USING (
        EXISTS (
            SELECT 1 FROM user_profiles 
            WHERE id = auth.uid() 
            AND role IN ('admin', 'super_admin')
        )
    );

-- Service categories: Public read, admin write
CREATE POLICY "Anyone can view active categories" ON service_categories
    FOR SELECT USING (is_active = true);

CREATE POLICY "Admins can manage categories" ON service_categories
    FOR ALL USING (
        EXISTS (
            SELECT 1 FROM user_profiles 
            WHERE id = auth.uid() 
            AND role IN ('admin', 'super_admin')
        )
    );

-- Vehicle sizes: Public read, admin write
CREATE POLICY "Anyone can view vehicle sizes" ON vehicle_sizes
    FOR SELECT USING (is_active = true);

CREATE POLICY "Admins can manage vehicle sizes" ON vehicle_sizes
    FOR ALL USING (
        EXISTS (
            SELECT 1 FROM user_profiles 
            WHERE id = auth.uid() 
            AND role IN ('admin', 'super_admin')
        )
    );

-- Time slots: Public read for available slots, admin full access
CREATE POLICY "Anyone can view available slots" ON time_slots
    FOR SELECT USING (is_available = true AND slot_date >= CURRENT_DATE);

CREATE POLICY "Admins can manage time slots" ON time_slots
    FOR ALL USING (
        EXISTS (
            SELECT 1 FROM user_profiles 
            WHERE id = auth.uid() 
            AND role IN ('admin', 'super_admin')
        )
    );

-- Public content
CREATE POLICY "Anyone can view testimonials" ON testimonials
    FOR SELECT USING (true);

CREATE POLICY "Anyone can view FAQ items" ON faq_items
    FOR SELECT USING (is_active = true);

CREATE POLICY "Anyone can view site settings" ON site_settings
    FOR SELECT USING (true);

-- Admin content management
CREATE POLICY "Admins can manage testimonials" ON testimonials
    FOR ALL USING (
        EXISTS (
            SELECT 1 FROM user_profiles 
            WHERE id = auth.uid() 
            AND role IN ('admin', 'super_admin')
        )
    );

CREATE POLICY "Admins can manage FAQ items" ON faq_items
    FOR ALL USING (
        EXISTS (
            SELECT 1 FROM user_profiles 
            WHERE id = auth.uid() 
            AND role IN ('admin', 'super_admin')
        )
    );

CREATE POLICY "Admins can manage site settings" ON site_settings
    FOR ALL USING (
        EXISTS (
            SELECT 1 FROM user_profiles 
            WHERE id = auth.uid() 
            AND role IN ('admin', 'super_admin')
        )
    );
```

---

## STEP 4: SEED DATA INSERTION (20 minutes)

### 4.1 Vehicle Sizes Configuration

```sql
-- Insert vehicle size categories
INSERT INTO vehicle_sizes (name, description, price_multiplier, examples, display_order) VALUES
('Small', 'Compact cars and small hatchbacks', 1.00, '{"Mini Cooper", "Fiat 500", "Toyota Yaris", "Volkswagen Polo"}', 1),
('Medium', 'Standard family cars and small SUVs', 1.20, '{"Ford Focus", "Volkswagen Golf", "BMW 3 Series", "Audi A4"}', 2),
('Large', 'Large family cars, estates, and mid-size SUVs', 1.50, '{"BMW 5 Series", "Mercedes E-Class", "Range Rover Sport", "Volvo XC60"}', 3),
('XL', 'Large SUVs, vans, and commercial vehicles', 1.80, '{"Range Rover", "Mercedes G-Wagon", "Ford Transit", "Large Commercial Vans"}', 4);
```

### 4.2 Service Categories and Services

```sql
-- Insert service categories
INSERT INTO service_categories (name, description, display_order) VALUES
('Exterior Detail', 'Comprehensive exterior cleaning and protection services', 1),
('Interior Detail', 'Deep cleaning and protection for vehicle interiors', 2),
('Full Service', 'Complete interior and exterior detailing packages', 3),
('Maintenance', 'Regular maintenance and touch-up services', 4);

-- Insert core services (using actual category IDs)
WITH category_ids AS (
    SELECT 
        'Exterior Detail' as cat_name,
        id as cat_id
    FROM service_categories WHERE name = 'Exterior Detail'
    UNION ALL
    SELECT 
        'Interior Detail' as cat_name,
        id as cat_id  
    FROM service_categories WHERE name = 'Interior Detail'
    UNION ALL
    SELECT 
        'Full Service' as cat_name,
        id as cat_id
    FROM service_categories WHERE name = 'Full Service'
    UNION ALL
    SELECT 
        'Maintenance' as cat_name,
        id as cat_id
    FROM service_categories WHERE name = 'Maintenance'
)
INSERT INTO services (category_id, name, slug, short_description, full_description, base_price, duration_minutes, display_order) 
SELECT 
    cat_id,
    name,
    slug,
    short_description,
    full_description,
    base_price,
    duration_minutes,
    display_order
FROM (
    SELECT 
        (SELECT cat_id FROM category_ids WHERE cat_name = 'Exterior Detail') as cat_id,
        'Premium Wash & Wax' as name,
        'premium-wash-wax' as slug,
        'Complete exterior transformation with premium products' as short_description,
        'A thorough exterior clean including pre-wash, contact wash, decontamination, and high-quality carnauba wax protection. Includes wheel cleaning, tire dressing, and exterior plastic restoration.' as full_description,
        45.00 as base_price,
        120 as duration_minutes,
        1 as display_order
    UNION ALL
    SELECT 
        (SELECT cat_id FROM category_ids WHERE cat_name = 'Exterior Detail'),
        'Paint Correction & Protection',
        'paint-correction-protection',
        'Professional paint correction with ceramic protection',
        'Multi-stage paint correction to remove swirl marks, scratches, and oxidation, followed by premium ceramic coating application for long-lasting protection and enhanced gloss.',
        120.00,
        240,
        2
    UNION ALL
    SELECT 
        (SELECT cat_id FROM category_ids WHERE cat_name = 'Interior Detail'),
        'Deep Interior Clean',
        'deep-interior-clean',
        'Comprehensive interior cleaning and protection',
        'Complete interior detailing including vacuum, steam cleaning, leather conditioning, fabric protection, and dashboard restoration. All surfaces cleaned and protected.',
        55.00,
        90,
        1
    UNION ALL
    SELECT 
        (SELECT cat_id FROM category_ids WHERE cat_name = 'Full Service'),
        'Complete Detail Package',
        'complete-detail-package',
        'Full interior and exterior transformation',
        'Our most comprehensive service combining premium exterior wash & wax with deep interior cleaning. Perfect for special occasions or seasonal maintenance.',
        85.00,
        180,
        1
    UNION ALL
    SELECT 
        (SELECT cat_id FROM category_ids WHERE cat_name = 'Maintenance'),
        'Maintenance Wash',
        'maintenance-wash',
        'Regular maintenance wash to keep your car looking great',
        'Quick but thorough exterior wash perfect for regular maintenance. Includes contact wash, wheel cleaning, and quick wax application.',
        25.00,
        60,
        1
) AS service_data;
```

### 4.3 Content Data

```sql
-- Insert testimonials
INSERT INTO testimonials (customer_name, customer_location, service_name, rating, review_text, is_featured, display_order) VALUES
('Sarah Mitchell', 'Hertfordshire', 'Premium Detail Package', 5, 'Absolutely exceptional service! My car has never looked better. The attention to detail was incredible and the team was professional throughout. Will definitely be booking again!', true, 1),
('James Thompson', 'Buckinghamshire', 'Paint Correction', 5, 'Outstanding work on my BMW. The paint correction removed years of swirl marks and the ceramic coating makes washing so much easier. Highly recommended!', true, 2),
('Emma Davies', 'Bedfordshire', 'Interior Deep Clean', 5, 'Amazing transformation of my family car interior. With two young kids, the seats were pretty messy, but they made it look like new again. Professional and reliable service.', true, 3);

-- Insert FAQ items
INSERT INTO faq_items (question, answer, category, display_order) VALUES
('How far in advance should I book?', 'We recommend booking at least 48 hours in advance, especially during peak periods like weekends and holidays. However, we often have same-day availability for urgent requests.', 'booking', 1),
('Do you provide all cleaning materials and equipment?', 'Yes, we bring everything needed including professional-grade cleaning products, equipment, water, and power sources. You just need to provide access to your vehicle.', 'service', 2),
('What if it rains on my booking day?', 'Light rain won''t stop us! We can work in most weather conditions using covered areas or waterproof equipment. For heavy rain or severe weather, we''ll reschedule at no extra cost.', 'weather', 3),
('How long does each service take?', 'Service times vary by package: Maintenance Wash (1 hour), Premium Wash & Wax (2 hours), Deep Interior Clean (1.5 hours), Complete Detail (3 hours). We''ll provide an accurate estimate when you book.', 'service', 4),
('Do you offer any guarantees?', 'Absolutely! We offer a 7-day satisfaction guarantee. If you''re not completely happy with our work, we''ll return to address any concerns at no additional charge.', 'guarantee', 5),
('Can I watch while you work on my car?', 'Of course! Many customers enjoy watching the transformation process. We''re always happy to explain our techniques and answer any questions about car care.', 'service', 6);

-- Insert site settings
INSERT INTO site_settings (setting_key, setting_value, description) VALUES
('business_hours', '{"monday": "8:00-18:00", "tuesday": "8:00-18:00", "wednesday": "8:00-18:00", "thursday": "8:00-18:00", "friday": "8:00-18:00", "saturday": "8:00-16:00", "sunday": "10:00-16:00"}', 'Business operating hours'),
('service_radius', '{"miles": 17.5, "surcharge_per_mile": 2.50, "free_radius": 10}', 'Service area configuration'),
('cancellation_policy', '{"hours_notice": 24, "fee_percentage": 0, "full_refund_hours": 48}', 'Booking cancellation policy'),
('contact_info', '{"phone": "+447123456789", "email": "info@love4detailing.co.uk", "address": "Hertfordshire, UK"}', 'Business contact information');
```

---

## STEP 5: COMPONENT LIBRARY INTEGRATION (45 minutes)

### 5.1 Create Component Library Structure

Create the following directory structure in your project:

```
src/
  components/
    ui/
      primitives/
      composites/
      patterns/
```

### 5.2 Component Library Validation and TypeScript Fixes

**Important:** Before importing your existing components, you need to validate and fix TypeScript strict mode compliance.

**Create: `src/lib/utils.ts`**

```typescript
import { type ClassValue, clsx } from 'clsx'
import { twMerge } from 'tailwind-merge'

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
```

### 5.3 Essential Component Interfaces

**Create: `src/types/components.ts`**

```typescript
import { ReactNode } from 'react'
import { VariantProps } from 'class-variance-authority'

// Base component props that all UI components should extend
export interface BaseComponentProps {
  className?: string
  children?: ReactNode
}

// Button component types
export interface ButtonProps extends BaseComponentProps {
  variant?: 'primary' | 'secondary' | 'outline' | 'ghost' | 'destructive'
  size?: 'sm' | 'md' | 'lg'
  disabled?: boolean
  type?: 'button' | 'submit' | 'reset'
  onClick?: () => void
}

// Input component types
export interface InputProps extends BaseComponentProps {
  type?: 'text' | 'email' | 'password' | 'tel' | 'number'
  placeholder?: string
  value?: string
  onChange?: (value: string) => void
  disabled?: boolean
  required?: boolean
  error?: string
}

// Modal component types
export interface ModalProps extends BaseComponentProps {
  isOpen: boolean
  onClose: () => void
  title?: string
  size?: 'sm' | 'md' | 'lg' | 'xl'
}

// Form field wrapper types
export interface FormFieldProps extends BaseComponentProps {
  label?: string
  error?: string
  required?: boolean
  helpText?: string
}
```

### 5.4 Component Import and Validation Process

**Step 1:** Copy your existing component library into the appropriate directories:
- Basic components (Button, Input, etc.) → `src/components/ui/primitives/`
- Complex components (forms, cards) → `src/components/ui/composites/`
- Layout patterns → `src/components/ui/patterns/`

**Step 2:** For each component file, run TypeScript validation:

```bash
npx tsc --noEmit --strict
```

**Step 3:** Common TypeScript fixes you'll need to apply:

**Fix 1: Explicit return types**
```typescript
// Before (will cause TypeScript error)
const Button = ({ children, ...props }) => {
  return <button {...props}>{children}</button>
}

// After (TypeScript compliant)
const Button = ({ children, ...props }: ButtonProps): JSX.Element => {
  return <button {...props}>{children}</button>
}
```

**Fix 2: Proper prop typing**
```typescript
// Before
interface ButtonProps {
  onClick?: () => void
  children: any // This will fail strict mode
}

// After
interface ButtonProps {
  onClick?: () => void
  children: ReactNode
}
```

**Fix 3: Event handler typing**
```typescript
// Before
const handleClick = (e) => {
  // TypeScript error: parameter 'e' implicitly has 'any' type
}

// After
const handleClick = (e: React.MouseEvent<HTMLButtonElement>) => {
  // Properly typed
}
```

### 5.5 Component Testing and Validation

**Create: `src/components/ui/primitives/Button.tsx`** (as example for validation)

```typescript
import React from 'react'
import { cva, type VariantProps } from 'class-variance-authority'
import { cn } from '@/lib/utils'

const buttonVariants = cva(
  'inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background',
  {
    variants: {
      variant: {
        primary: 'bg-primary text-primary-foreground hover:bg-primary/90',
        secondary: 'bg-secondary text-secondary-foreground hover:bg-secondary/80',
        outline: 'border border-input hover:bg-accent hover:text-accent-foreground',
        ghost: 'hover:bg-accent hover:text-accent-foreground',
        destructive: 'bg-destructive text-destructive-foreground hover:bg-destructive/90',
      },
      size: {
        sm: 'h-9 px-3 rounded-md',
        md: 'h-10 py-2 px-4',
        lg: 'h-11 px-8 rounded-md',
      },
    },
    defaultVariants: {
      variant: 'primary',
      size: 'md',
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  children: React.ReactNode
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, children, ...props }, ref) => {
    return (
      <button
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      >
        {children}
      </button>
    )
  }
)
Button.displayName = 'Button'

export { Button, buttonVariants }
```

**Validation Steps:**

1. **Compile Check:**
```bash
npm run build
```
This should complete without TypeScript errors.

2. **Runtime Test:**
Create a simple test page to verify components work:

**Create: `src/app/component-test/page.tsx`**

```typescript
import { Button } from '@/components/ui/primitives/Button'

export default function ComponentTest(): JSX.Element {
  return (
    <div className="p-8 space-y-4">
      <h1 className="text-2xl font-bold">Component Library Test</h1>
      
      <div className="space-x-2">
        <Button variant="primary">Primary Button</Button>
        <Button variant="secondary">Secondary Button</Button>
        <Button variant="outline">Outline Button</Button>
      </div>
      
      <p className="text-green-600">
        ✅ If you can see this page without errors, your components are working!
      </p>
    </div>
  )
}
```

3. **Test the page:**
```bash
npm run dev
```
Navigate to `http://localhost:3000/component-test` and verify everything renders correctly.

---

## STEP 6: SUPABASE CLIENT CONFIGURATION (20 minutes)

### 6.1 Create Supabase Client Utilities

**Create: `src/lib/supabase/client.ts`**

```typescript
import { createBrowserClient } from '@supabase/ssr'
import { Database } from './types'

export const createClient = () => {
  return createBrowserClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )
}
```

**Create: `src/lib/supabase/server.ts`**

```typescript
import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'
import { Database } from './types'

export const createClient = () => {
  const cookieStore = cookies()

  return createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll()
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            )
          } catch {
            // The `setAll` method was called from a Server Component.
            // This can be ignored if you have middleware refreshing
            // user sessions.
          }
        },
      },
    }
  )
}
```

### 6.2 Generate Database Types

**Important:** You need to generate TypeScript types from your Supabase schema.

1. **Install Supabase CLI:**
```bash
npm install -g supabase
```

2. **Login to Supabase:**
```bash
supabase login
```

3. **Generate types:**
```bash
supabase gen types typescript --project-id YOUR_PROJECT_ID > src/lib/supabase/types.ts
```

Replace `YOUR_PROJECT_ID` with your actual Supabase project ID (found in your project settings).

### 6.3 Middleware Configuration

**Create: `src/middleware.ts`**

```typescript
import { createServerClient } from '@supabase/ssr'
import { NextResponse, type NextRequest } from 'next/server'

export async function middleware(request: NextRequest) {
  let supabaseResponse = NextResponse.next({
    request,
  })

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll()
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) => request.cookies.set(name, value))
          supabaseResponse = NextResponse.next({
            request,
          })
          cookiesToSet.forEach(({ name, value, options }) =>
            supabaseResponse.cookies.set(name, value, options)
          )
        },
      },
    }
  )

  // Refresh session if expired
  const {
    data: { user },
  } = await supabase.auth.getUser()

  // Protect admin routes
  if (request.nextUrl.pathname.startsWith('/admin')) {
    if (!user) {
      return NextResponse.redirect(new URL('/auth/login', request.url))
    }

    // Check admin role
    const { data: profile } = await supabase
      .from('user_profiles')
      .select('role')
      .eq('id', user.id)
      .single()

    if (!profile || !['admin', 'super_admin'].includes(profile.role)) {
      return NextResponse.redirect(new URL('/dashboard', request.url))
    }
  }

  // Protect customer dashboard
  if (request.nextUrl.pathname.startsWith('/dashboard')) {
    if (!user) {
      return NextResponse.redirect(new URL('/auth/login', request.url))
    }
  }

  return supabaseResponse
}

export const config = {
  matcher: [
    '/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',
  ],
}
```

---

## STEP 7: CONFIGURATION AND UTILITIES (25 minutes)

### 7.1 Environment Configuration

**Create: `src/lib/config/environment.ts`**

```typescript
interface EnvironmentConfig {
  app: {
    env: 'development' | 'staging' | 'production'
    url: string
    name: string
  }
  supabase: {
    url: string
    anonKey: string
    serviceRoleKey?: string
  }
  business: {
    name: string
    phone: string
    email: string
    serviceRadiusMiles: number
  }
  email: {
    fromEmail: string
    resendApiKey?: string
  }
}

function getRequiredEnvVar(key: string): string {
  const value = process.env[key]
  if (!value) {
    throw new Error(`Missing required environment variable: ${key}`)
  }
  return value
}

function getOptionalEnvVar(key: string, defaultValue?: string): string | undefined {
  return process.env[key] || defaultValue
}

export const env: EnvironmentConfig = {
  app: {
    env: (getOptionalEnvVar('NEXT_PUBLIC_APP_ENV', 'development') as 'development' | 'staging' | 'production'),
    url: getRequiredEnvVar('NEXT_PUBLIC_APP_URL'),
    name: getOptionalEnvVar('NEXT_PUBLIC_COMPANY_NAME', 'Love4Detailing')!,
  },
  supabase: {
    url: getRequiredEnvVar('NEXT_PUBLIC_SUPABASE_URL'),
    anonKey: getRequiredEnvVar('NEXT_PUBLIC_SUPABASE_ANON_KEY'),
    serviceRoleKey: getOptionalEnvVar('SUPABASE_SERVICE_ROLE_KEY'),
  },
  business: {
    name: getOptionalEnvVar('NEXT_PUBLIC_COMPANY_NAME', 'Love4Detailing')!,
    phone: getOptionalEnvVar('NEXT_PUBLIC_COMPANY_PHONE', '+447123456789')!,
    email: getOptionalEnvVar('NEXT_PUBLIC_COMPANY_EMAIL', 'info@love4detailing.co.uk')!,
    serviceRadiusMiles: parseFloat(getOptionalEnvVar('NEXT_PUBLIC_SERVICE_RADIUS_MILES', '17.5')!),
  },
  email: {
    fromEmail: getOptionalEnvVar('NEXT_PUBLIC_FROM_EMAIL', 'noreply@love4detailing.co.uk')!,
    resendApiKey: getOptionalEnvVar('RESEND_API_KEY'),
  },
}

export const isDevelopment = env.app.env === 'development'
export const isProduction = env.app.env === 'production'
export const isStaging = env.app.env === 'staging'
```

### 7.2 Database Utilities

**Create: `src/lib/utils/database.ts`**

```typescript
import { Database } from '@/lib/supabase/types'

// Type aliases for easier use
export type Tables<T extends keyof Database['public']['Tables']> = Database['public']['Tables'][T]['Row']
export type Enums<T extends keyof Database['public']['Enums']> = Database['public']['Enums'][T]

// Common database types
export type UserProfile = Tables<'user_profiles'>
export type Service = Tables<'services'>
export type ServiceCategory = Tables<'service_categories'>
export type VehicleSize = Tables<'vehicle_sizes'>
export type Booking = Tables<'bookings'>
export type CustomerAddress = Tables<'customer_addresses'>
export type CustomerVehicle = Tables<'customer_vehicles'>
export type TimeSlot = Tables<'time_slots'>
export type Testimonial = Tables<'testimonials'>
export type FAQItem = Tables<'faq_items'>
export type SiteSetting = Tables<'site_settings'>

// Enums
export type BookingStatus = Enums<'booking_status'>

// Extended types with relationships
export interface BookingWithDetails extends Booking {
  customer?: UserProfile
  service?: Service
  vehicle?: CustomerVehicle & {
    vehicle_size?: VehicleSize
  }
  address?: CustomerAddress
  time_slot?: TimeSlot
}

export interface ServiceWithCategory extends Service {
  category?: ServiceCategory
}

// Transform functions for API responses
export function transformBookingForAPI(booking: BookingWithDetails): any {
  return {
    id: booking.id,
    bookingReference: booking.booking_reference,
    status: booking.status,
    totalPrice: booking.total_price,
    scheduledDate: booking.scheduled_date,
    scheduledStartTime: booking.scheduled_start_time,
    scheduledEndTime: booking.scheduled_end_time,
    specialInstructions: booking.special_instructions,
    customer: booking.customer ? {
      id: booking.customer.id,
      firstName: booking.customer.first_name,
      lastName: booking.customer.last_name,
      email: booking.customer.email,
      phone: booking.customer.phone,
    } : null,
    service: booking.service ? {
      id: booking.service.id,
      name: booking.service.name,
      duration: booking.service.duration_minutes,
    } : null,
    vehicle: booking.vehicle ? {
      id: booking.vehicle.id,
      make: booking.vehicle.make,
      model: booking.vehicle.model,
      year: booking.vehicle.year,
      color: booking.vehicle.color,
      size: booking.vehicle.vehicle_size?.name,
    } : null,
    address: booking.address ? {
      id: booking.address.id,
      addressLine1: booking.address.address_line_1,
      addressLine2: booking.address.address_line_2,
      city: booking.address.city,
      postalCode: booking.address.postal_code,
      county: booking.address.county,
    } : null,
  }
}
```

### 7.3 Validation Schemas

**Create: `src/lib/validation/schemas.ts`**

```typescript
import { z } from 'zod'

// User schemas
export const userProfileSchema = z.object({
  firstName: z.string().min(1, 'First name is required').max(100),
  lastName: z.string().min(1, 'Last name is required').max(100),
  email: z.string().email('Invalid email address'),
  phone: z.string().optional(),
})

// Address schemas
export const addressSchema = z.object({
  addressLine1: z.string().min(1, 'Address line 1 is required').max(255),
  addressLine2: z.string().optional(),
  city: z.string().min(1, 'City is required').max(100),
  postalCode: z.string().min(1, 'Postal code is required').max(20),
  county: z.string().optional().default(''),
  country: z.string().length(2).default('GB'),
})

// Vehicle schemas
export const vehicleSchema = z.object({
  vehicleSizeId: z.string().uuid('Invalid vehicle size'),
  make: z.string().min(1, 'Make is required').max(50),
  model: z.string().min(1, 'Model is required').max(50),
  year: z.number().min(1900).max(new Date().getFullYear() + 1),
  color: z.string().min(1, 'Color is required').max(30),
  licensePlate: z.string().optional(),
  notes: z.string().optional(),
})

// Booking schemas
export const bookingSchema = z.object({
  serviceId: z.string().uuid('Invalid service ID'),
  vehicleId: z.string().uuid('Invalid vehicle ID'),
  addressId: z.string().uuid('Invalid address ID'),
  timeSlotId: z.string().uuid('Invalid time slot ID'),
  specialInstructions: z.string().optional(),
})

// Time slot schemas
export const timeSlotSchema = z.object({
  slotDate: z.string().refine((date) => {
    const parsedDate = new Date(date)
    return parsedDate >= new Date() && !isNaN(parsedDate.getTime())
  }, 'Invalid date or date in the past'),
  startTime: z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/, 'Invalid time format'),
  endTime: z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/, 'Invalid time format'),
  maxBookings: z.number().min(1).default(1),
  notes: z.string().optional(),
})

// API response schemas
export const apiResponseSchema = z.object({
  success: z.boolean(),
  data: z.any().optional(),
  error: z.object({
    message: z.string(),
    code: z.string().optional(),
  }).optional(),
  metadata: z.object({
    pagination: z.object({
      page: z.number(),
      limit: z.number(),
      total: z.number(),
      totalPages: z.number(),
    }).optional(),
    timestamp: z.string().optional(),
  }).optional(),
})
```

---

## STEP 8: BASIC LAYOUT AND ROUTING SETUP (30 minutes)

### 8.1 Root Layout Configuration

**Update: `src/app/layout.tsx`**

```typescript
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'
import { env } from '@/lib/config/environment'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: {
    default: `${env.business.name} - Professional Mobile Car Detailing`,
    template: `%s | ${env.business.name}`,
  },
  description: 'Professional mobile car detailing services. Premium wash & wax, paint correction, interior cleaning, and ceramic protection. Fully insured and eco-friendly.',
  keywords: ['car detailing', 'mobile car wash', 'paint correction', 'ceramic coating', 'interior cleaning'],
  authors: [{ name: env.business.name }],
  creator: env.business.name,
  openGraph: {
    type: 'website',
    locale: 'en_GB',
    url: env.app.url,
    title: `${env.business.name} - Professional Mobile Car Detailing`,
    description: 'Professional mobile car detailing services in your area.',
    siteName: env.business.name,
  },
  twitter: {
    card: 'summary_large_image',
    title: `${env.business.name} - Professional Mobile Car Detailing`,
    description: 'Professional mobile car detailing services in your area.',
  },
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
    },
  },
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}): JSX.Element {
  return (
    <html lang="en">
      <body className={inter.className}>
        <div className="min-h-screen bg-background text-foreground">
          {children}
        </div>
      </body>
    </html>
  )
}
```

### 8.2 Tailwind Configuration

**Update: `tailwind.config.ts`**

```typescript
import type { Config } from 'tailwindcss'

const config: Config = {
  darkMode: 'class',
  content: [
    './src/pages/**/*.{js,ts,jsx,tsx,mdx}',
    './src/components/**/*.{js,ts,jsx,tsx,mdx}',
    './src/app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        border: 'hsl(var(--border))',
        input: 'hsl(var(--input))',
        ring: 'hsl(var(--ring))',
        background: 'hsl(var(--background))',
        foreground: 'hsl(var(--foreground))',
        primary: {
          DEFAULT: 'hsl(var(--primary))',
          foreground: 'hsl(var(--primary-foreground))',
        },
        secondary: {
          DEFAULT: 'hsl(var(--secondary))',
          foreground: 'hsl(var(--secondary-foreground))',
        },
        destructive: {
          DEFAULT: 'hsl(var(--destructive))',
          foreground: 'hsl(var(--destructive-foreground))',
        },
        muted: {
          DEFAULT: 'hsl(var(--muted))',
          foreground: 'hsl(var(--muted-foreground))',
        },
        accent: {
          DEFAULT: 'hsl(var(--accent))',
          foreground: 'hsl(var(--accent-foreground))',
        },
        popover: {
          DEFAULT: 'hsl(var(--popover))',
          foreground: 'hsl(var(--popover-foreground))',
        },
        card: {
          DEFAULT: 'hsl(var(--card))',
          foreground: 'hsl(var(--card-foreground))',
        },
      },
      borderRadius: {
        lg: 'var(--radius)',
        md: 'calc(var(--radius) - 2px)',
        sm: 'calc(var(--radius) - 4px)',
      },
    },
  },
  plugins: [],
}

export default config
```

### 8.3 Global CSS with Design System

**Update: `src/app/globals.css`**

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 221.2 83.2% 53.3%;
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96%;
    --secondary-foreground: 222.2 84% 4.9%;
    --muted: 210 40% 96%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96%;
    --accent-foreground: 222.2 84% 4.9%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 221.2 83.2% 53.3%;
    --radius: 0.5rem;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 217.2 91.2% 59.8%;
    --primary-foreground: 222.2 84% 4.9%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 224.3 76.3% 94.1%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}

@layer components {
  .container {
    @apply mx-auto px-4 sm:px-6 lg:px-8;
  }
  
  .page-header {
    @apply border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60;
  }
  
  .content-section {
    @apply py-8 md:py-12 lg:py-16;
  }
}
```

### 8.4 Basic Page Structure

**Create: `src/app/page.tsx`** (Temporary homepage)

```typescript
import { env } from '@/lib/config/environment'

export default function HomePage(): JSX.Element {
  return (
    <div className="min-h-screen flex items-center justify-center">
      <div className="text-center">
        <h1 className="text-4xl font-bold text-primary mb-4">
          {env.business.name}
        </h1>
        <p className="text-lg text-muted-foreground mb-8">
          Professional Mobile Car Detailing Services
        </p>
        <div className="space-y-2 text-sm">
          <p>✅ Phase 1: Foundation & Database - Complete</p>
          <p className="text-muted-foreground">Ready for Phase 2: API & Services</p>
        </div>
      </div>
    </div>
  )
}
```

**Create route structure directories:**

```bash
mkdir -p src/app/{auth,dashboard,admin,book,api}
mkdir -p src/app/auth/{login,register}
mkdir -p src/app/api/{auth,bookings,services,admin}
```

---

## STEP 9: VALIDATION AND TESTING (30 minutes)

### 9.1 TypeScript Compilation Test

Run the following commands to ensure everything compiles correctly:

```bash
# Check TypeScript compilation
npx tsc --noEmit

# Run development server
npm run dev

# Test build for production
npm run build
```

**Expected Results:**
- No TypeScript errors
- Development server starts successfully
- Build completes without errors
- Homepage displays correctly at `http://localhost:3000`

### 9.2 Database Connection Test

**Create: `src/app/api/health/route.ts`**

```typescript
import { NextResponse } from 'next/server'
import { createClient } from '@/lib/supabase/server'

export async function GET() {
  try {
    const supabase = createClient()
    
    // Test database connection
    const { data: services, error } = await supabase
      .from('services')
      .select('id, name')
      .limit(1)

    if (error) {
      throw error
    }

    return NextResponse.json({
      success: true,
      data: {
        status: 'healthy',
        database: 'connected',
        servicesCount: services?.length || 0,
        timestamp: new Date().toISOString(),
      },
    })
  } catch (error) {
    console.error('Health check failed:', error)
    
    return NextResponse.json({
      success: false,
      error: {
        message: 'Health check failed',
        code: 'HEALTH_CHECK_FAILED',
      },
    }, { status: 500 })
  }
}
```

**Test the endpoint:**
```bash
curl http://localhost:3000/api/health
```

**Expected response:**
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "database": "connected",
    "servicesCount": 5,
    "timestamp": "2024-01-15T10:30:00.000Z"
  }
}
```

### 9.3 Component Library Test

Visit `http://localhost:3000/component-test` and verify:
- All buttons render correctly
- No console errors
- Styling is applied properly
- Interactive elements work

### 9.4 Environment Configuration Test

**Create: `src/app/api/config/route.ts`**

```typescript
import { NextResponse } from 'next/server'
import { env } from '@/lib/config/environment'

export async function GET() {
  return NextResponse.json({
    success: true,
    data: {
      app: {
        env: env.app.env,
        url: env.app.url,
        name: env.app.name,
      },
      business: {
        name: env.business.name,
        phone: env.business.phone,
        email: env.business.email,
        serviceRadiusMiles: env.business.serviceRadiusMiles,
      },
      supabase: {
        url: env.supabase.url,
        hasServiceKey: !!env.supabase.serviceRoleKey,
      },
    },
  })
}
```

Test: `curl http://localhost:3000/api/config`

---

## PHASE 1 SUCCESS CRITERIA CHECKLIST

Before proceeding to Phase 2, verify all the following items are complete:

### ✅ **Foundation Setup**
- [ ] Next.js 14 project created with TypeScript strict mode
- [ ] All required dependencies installed
- [ ] Environment variables configured
- [ ] Tailwind CSS and design system working

### ✅ **Database Architecture**
- [ ] Supabase database schema created
- [ ] All tables created with proper relationships
- [ ] Row Level Security policies implemented
- [ ] Seed data inserted successfully
- [ ] Database connection test passes

